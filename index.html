<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IEP 填寫小工具</title>
  <!-- 外部樣式表連結 -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- 主容器 - 包裹整個應用程式 -->
  <div class="container">
    <!-- 標題區域 -->
    <div class="header">
      <h1>IEP 填寫小工具</h1>
      <p class="subtitle">個別化教育計畫輔助工具<br>by <a href="aspieorca.org" target="_blank">亞斯星來的殺人鯨</a></p>
    </div>

    <!-- 安全提示區域 -->
    <div class="security-notice">
      <div class="notice-content">
        <h3>🔒 資料安全提醒</h3>
        <p>
          本工具會自動儲存您的輸入內容到瀏覽器本地，以防止資料遺失。<br>
          <strong>重要：</strong>資料會保留在您的設備上直到手動清除。<br>
          如在共用電腦使用，請於使用完畢後點擊下方「清空所有資料」按鈕。
        </p>
        <button type="button" id="clearDataBtn" class="clear-data-btn">🗑️ 清空所有資料</button>
      </div>
    </div>

    <!-- 表單區域 -->
    <div class="form-container">
  <form id="iepForm">
        <!-- 每個輸入欄位都包裝在 form-group 中 -->
        <div class="form-group">
          <label>1. 健康與感官</label>
          <div class="field-description">
            <strong>健康狀況：</strong>身體健康情形、醫療與使用藥物介入對其學習、參與適齡活動及生活適應之限制、影響與需求。<br>
            <strong>感官功能：</strong>視覺、聽覺功能或身體四肢外觀、四肢功能及整體體能表現，對其學習、參與適齡活動及生活適應的限制、影響與需求。<br>
            <strong>輔具使用：</strong>如有使用輔具，需說明其適用性及使用後現況的影響。
          </div>
          <textarea name="健康與感官" placeholder="例如：視力正常，聽力輕度損失需配戴助聽器，整體體能表現良好，無特殊藥物需求..."></textarea>
        </div>
        
        <div class="form-group">
          <label>2. 知覺與動作</label>
          <div class="field-description">
            <strong>感官知覺：</strong>視知覺、聽知覺、精細與粗大動作。<br>
            <strong>動作能力：</strong>動作協調、工具操作、平衡、運動機能、技巧性運動技能。<br>
            <strong>行動能力：</strong>參與運動、定位、行動（上下樓、社區移動）及輔具運用等能力表現。<br>
            <strong>影響評估：</strong>對學習、參與適齡活動及生活適應的限制、影響與需求。
          </div>
          <textarea name="知覺與動作" placeholder="例如：手眼協調良好，能使用剪刀、筆等工具，平衡感稍弱需扶持上下樓梯..."></textarea>
        </div>
        
        <div class="form-group">
          <label>3. 認知與智力</label>
          <div class="field-description">
            <strong>智力測驗結果：</strong>最近一次智力測驗結果。<br>
            <strong>測驗工具：</strong>魏氏兒童智力量表或其他標準化智力測驗，如 CPM、SPM、國中入學團體智力測驗、托尼非語文智力測驗、單保德圖畫詞彙測驗等。
          </div>
          <textarea name="認知與智力" placeholder="例如：魏氏兒童智力量表全量表智商 85，語文智商 80，作業智商 90..."></textarea>
        </div>
        
        <div class="form-group">
          <label>4. 認知（學習與記憶等功能）</label>
          <div class="field-description">
            <strong>注意力：</strong>集中性、持續性、選擇性、交替性、分配性；不同情境差異（小組、團體、個別等）。<br>
            <strong>記憶功能：</strong>短期記憶、長期記憶、工作記憶等。<br>
            <strong>認知歷程：</strong>理解、推理、邏輯、問題解決、計畫、執行、監控等認知歷程能力表現。<br>
            <strong>學習管道：</strong>優勢與弱勢學習管道。<br>
            <strong>影響評估：</strong>對學習、參與適齡活動及生活適應的限制、影響與需求。
          </div>
          <textarea name="認知（學習與記憶等功能）" placeholder="例如：注意力持續時間約 15 分鐘，視覺學習效果較佳，工作記憶稍弱需重複提示..."></textarea>
        </div>
        
        <div class="form-group">
          <label>5. 語言與溝通</label>
          <div class="field-description">
            <strong>溝通模式：</strong>指口語、文字、動作之表達與理解。<br>
            <strong>互動狀況：</strong>溝通時理解、表達、互動狀況；溝通模式與有效性。<br>
            <strong>語音狀況：</strong>聲音特質、清晰度、構音狀況、聲調及主動性/被動性造成的溝通問題。<br>
            <strong>特殊需求：</strong>低口語或無口語學生可用「輔助溝通系統評估表」補充說明。
          </div>
          <textarea name="語言與溝通" placeholder="例如：口語表達清晰，能理解簡單指令，主動溝通意願較低，需要鼓勵..."></textarea>
        </div>
        
        <div class="form-group">
          <label>6. 生活自理</label>
          <div class="field-description">
            <strong>自我照顧：</strong>飲食、穿著、沐浴、如廁等。<br>
            <strong>居家生活：</strong>居家生活、生活習慣、社區運用。<br>
            <strong>生活管理：</strong>生活管理與自我管理（金錢管理、行事規劃、準時赴約）。<br>
            <strong>影響評估：</strong>對學習、參與適齡活動及生活適應的限制、影響與需求。
          </div>
          <textarea name="生活自理" placeholder="例如：能獨立進食，穿脫衣物需協助，如廁訓練中，時間概念待加強..."></textarea>
        </div>
        
        <div class="form-group">
          <label>7. 情緒與社會人際</label>
          <div class="field-description">
            <strong>情緒管理：</strong>處理情緒的能力、壓力的反應與穩定度、挫折忍受力；內向或外向行為問題；固著或不當行為。<br>
            <strong>社會人際：</strong>自我認知與瞭解、人際關係、活動參與、團體規範遵守及團體互動等技巧表現。<br>
            <strong>影響評估：</strong>對學習、參與適齡活動及生活適應的限制、影響與需求。
          </div>
          <textarea name="情緒與社會人際" placeholder="例如：情緒穩定，但挫折忍受力較低，喜歡與同儕互動，遵守團體規範..."></textarea>
        </div>
        
        <div class="form-group">
          <label>8. 基本學習技能與各領域</label>
          <div class="field-description">
            <strong>基本技能測驗：</strong>最近一次學業基本技能（識字、詞彙、書寫、數學基礎計算、閱讀理解）測驗結果摘要。
          </div>
          <textarea name="基本學習技能與各領域" placeholder="例如：識字能力約國小二年級程度，基礎計算能力良好，閱讀理解需加強..."></textarea>
        </div>
        
        <div class="form-group">
          <label>9. 學科學習表現</label>
          <div class="field-description">
            <strong>學習表現：</strong>學科學習相關及整體學業成就表現，與學習行為及特質。<br>
            <strong>評量方式：</strong>非正式評量或測驗、各科學業成就（如成績、學期表現、檔案評量）。<br>
            <strong>調整成效：</strong>評量方式差異、調整後之成效。<br>
            <strong>學習特質：</strong>個人學習行為態度、興趣與策略、作業完成的困難、調整方式與效果、優勢與弱勢學習管道。
          </div>
          <textarea name="學科學習表現" placeholder="例如：數學計算能力佳，國語閱讀理解需加強，對美術有興趣，作業完成需要分段提示..."></textarea>
        </div>

        <!-- 提交按鈕區域 -->
        <div class="submit-container">
          <button type="submit" class="submit-btn">生成 IEP 清單</button>
        </div>
  </form>
    </div>

    <!-- 輸出結果區域 -->
    <div class="output-section">
      <h3 class="output-title">生成的 IEP 清單</h3>
      <div id="output">點擊上方按鈕生成 IEP 清單...</div>
    </div>
  </div>

  <script>
    // 等待 DOM 載入完成 - 就像等演員就位才開演
    document.addEventListener('DOMContentLoaded', function() {
      console.log('IEP 工具已載入完成'); // 記錄工具啟動
      
      const form = document.getElementById("iepForm");
      const output = document.getElementById("output");
      const submitBtn = document.querySelector(".submit-btn");

      // 表單提交處理 - 就像收集所有答案然後整理成報告
      form.addEventListener("submit", function(e) {
      e.preventDefault();
        console.log('開始生成 IEP 清單'); // 記錄操作開始
        
        // 按鈕載入狀態 - 讓用戶知道系統正在處理
        submitBtn.disabled = true;
        submitBtn.textContent = "生成中...";
        submitBtn.style.opacity = "0.7";
        
        // 模擬處理時間，讓用戶感受到系統在工作
        setTimeout(() => {
          generateIEPList();
          
          // 恢復按鈕狀態
          submitBtn.disabled = false;
          submitBtn.textContent = "生成 IEP 清單";
          submitBtn.style.opacity = "1";
          
          console.log('IEP 清單生成完成'); // 記錄操作完成
        }, 800);
      });

      // 生成 IEP 清單的核心功能 - 就像把零散的筆記整理成完整報告
      function generateIEPList() {
        const formData = new FormData(form);
        let outputText = "";
      let index = 1;
        
        // 遍歷每個表單欄位，組織成格式化的文字
      for (const [key, value] of formData.entries()) {
          const content = value.trim();
          outputText += `${index}. ${key}\n`;
          outputText += content || "（此項目暫未填寫）";
          outputText += "\n\n";
        index++;
        }
        
        // 更新輸出區域，添加淡入效果
        output.style.opacity = "0";
        setTimeout(() => {
          output.textContent = outputText.trim() || "請填寫至少一個欄位後再生成清單";
          output.style.opacity = "1";
          
          // 如果有內容，捲動到結果區域 - 像是自動翻頁到結果頁面
          if (outputText.trim()) {
            output.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start' 
            });
          }
        }, 300);
      }

      // 為所有文字輸入框加入即時計數功能 - 就像寫作軟體的字數統計
      const textareas = document.querySelectorAll('textarea');
      textareas.forEach((textarea, index) => {
        // 創建字數統計顯示
        const counter = document.createElement('div');
        counter.className = 'char-counter';
        counter.style.cssText = `
          font-size: 0.8rem;
          color: #6b7280;
          text-align: right;
          margin-top: 4px;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;
        textarea.parentNode.appendChild(counter);

        // 更新字數統計的函數
        function updateCounter() {
          const length = textarea.value.length;
          counter.textContent = `${length} 個字`;
          counter.style.opacity = length > 0 ? '1' : '0';
        }

        // 監聽輸入事件
        textarea.addEventListener('input', updateCounter);
        textarea.addEventListener('focus', () => {
          console.log(`開始編輯：${textarea.name}`); // 記錄用戶操作
          counter.style.opacity = '1';
        });
        textarea.addEventListener('blur', () => {
          if (textarea.value.length === 0) {
            counter.style.opacity = '0';
          }
        });

        // 初始化字數統計
        updateCounter();
      });

      // 加入複製到剪貼簿功能 - 就像一鍵複製功能
      const copyButton = document.createElement('button');
      copyButton.type = 'button';
      copyButton.className = 'copy-btn';
      copyButton.textContent = '複製到剪貼簿';
      copyButton.style.cssText = `
        background: #10b981;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        margin-top: 16px;
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(10px);
      `;

      // 複製按鈕的樣式效果
      copyButton.addEventListener('mouseenter', () => {
        copyButton.style.background = '#059669';
        copyButton.style.transform = 'translateY(-2px)';
      });
      copyButton.addEventListener('mouseleave', () => {
        copyButton.style.background = '#10b981';
        copyButton.style.transform = 'translateY(0)';
      });

      // 複製功能實現
      copyButton.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(output.textContent);
          
          // 成功回饋 - 就像給用戶一個「已完成」的手勢
          const originalText = copyButton.textContent;
          copyButton.textContent = '已複製!';
          copyButton.style.background = '#059669';
          
          setTimeout(() => {
            copyButton.textContent = originalText;
            copyButton.style.background = '#10b981';
          }, 2000);
          
          console.log('文字已複製到剪貼簿'); // 記錄操作
        } catch (err) {
          console.error('複製失敗:', err);
          alert('複製失敗，請手動選取文字複製');
        }
      });

      // 將複製按鈕加入到輸出區域
      document.querySelector('.output-section').appendChild(copyButton);

      // 監聽輸出內容變化，控制複製按鈕顯示
      const observer = new MutationObserver(() => {
        const hasContent = output.textContent.trim() && 
                          !output.textContent.includes('點擊上方按鈕') &&
                          !output.textContent.includes('請填寫至少一個欄位');
        
        if (hasContent) {
          copyButton.style.opacity = '1';
          copyButton.style.transform = 'translateY(0)';
        } else {
          copyButton.style.opacity = '0';
          copyButton.style.transform = 'translateY(10px)';
        }
      });

      observer.observe(output, { childList: true, characterData: true, subtree: true });

      // 鍵盤快捷鍵支援 - 就像專業軟體的快速操作
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + Enter: 快速提交表單
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          form.dispatchEvent(new Event('submit'));
          console.log('使用快捷鍵提交表單'); // 記錄快捷鍵使用
        }
      });

      // 自動儲存功能 - 就像自動存檔功能，防止資料遺失
      function autoSave() {
        const formData = {};
        textareas.forEach(textarea => {
          if (textarea.value.trim()) {
            formData[textarea.name] = textarea.value;
          }
        });
        
        if (Object.keys(formData).length > 0) {
          localStorage.setItem('iep_form_data', JSON.stringify(formData));
          console.log('表單資料已自動儲存'); // 記錄自動儲存
        }
      }

      // 載入先前儲存的資料
      function loadSavedData() {
        try {
          const savedData = localStorage.getItem('iep_form_data');
          if (savedData) {
            const formData = JSON.parse(savedData);
            Object.entries(formData).forEach(([name, value]) => {
              const textarea = document.querySelector(`textarea[name="${name}"]`);
              if (textarea) {
                textarea.value = value;
                // 觸發字數統計更新
                textarea.dispatchEvent(new Event('input'));
              }
            });
            console.log('已載入先前儲存的資料'); // 記錄資料載入
          }
        } catch (err) {
          console.error('載入儲存資料失敗:', err);
        }
      }

      // 每 30 秒自動儲存一次
      setInterval(autoSave, 30000);

      // 在欄位失去焦點時也進行儲存
      textareas.forEach(textarea => {
        textarea.addEventListener('blur', autoSave);
      });

      // 載入頁面時嘗試恢復資料
      loadSavedData();

      // 說明文字保持展開狀態 - 所有說明都清楚可見
      console.log('說明文字已設定為永久展開模式'); // 記錄設定狀態

      // 清空所有資料功能 - 就像是重置按鈕，讓一切回到最初狀態
      const clearDataBtn = document.getElementById('clearDataBtn');
      
      clearDataBtn.addEventListener('click', function() {
        // 顯示確認對話框，防止誤操作
        const confirmClear = confirm(
          '⚠️ 確定要清空所有已儲存的資料嗎？\n\n' +
          '這個動作將會：\n' +
          '• 清空目前所有輸入框的內容\n' +
          '• 刪除瀏覽器中儲存的資料\n' +
          '• 此動作無法復原\n\n' +
          '確定要繼續嗎？'
        );
        
        if (confirmClear) {
          try {
            // 清空所有輸入框
            textareas.forEach(textarea => {
              textarea.value = '';
              // 觸發字數統計更新
              textarea.dispatchEvent(new Event('input'));
            });
            
            // 清空輸出區域
            output.textContent = '點擊上方按鈕生成 IEP 清單...';
            
            // 刪除瀏覽器儲存的資料
            localStorage.removeItem('iep_form_data');
            
            // 成功提示
            alert('✅ 所有資料已成功清空！');
            console.log('用戶手動清空所有資料'); // 記錄操作
            
          } catch (error) {
            console.error('清空資料時發生錯誤:', error);
            alert('❌ 清空資料時發生錯誤，請重新整理頁面後再試。');
          }
        } else {
          console.log('用戶取消清空資料操作'); // 記錄取消操作
        }
      });

      console.log('IEP 工具初始化完成，所有功能已就緒'); // 記錄初始化完成
    });
  </script>
</body>
</html>
